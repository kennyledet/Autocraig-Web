{% extends "base.html" %}
{% block main %}
    <div class="pure-u" id="list"><!-- col2 -->
        <div class="content">
        	<!-- display messages -->
        	{% for message in messages %}

            <div class="email-item pure-g">

                <div class="pure-u-3-4">
                    <h5 class="email-name">Created: {{ message.created_at }}</h5>
                    <h4 class="email-subject">{{ message.subject }}</h4>
                    <p class="email-desc">
                        {{ message.body }}
                    </p>
                </div>
            </div>

            {% endfor %}

        </div>
    </div>


<div class="pure-u" id="main">
<div class="content">
<div class="email-content pure-r">
	<div class="email-content-header pure-r"><!-- col3-->
        <div class="pure-r">
            <h1 class="email-content-title">New Task</h1>
            <p class="email-content-subtitle">
                at <span>2:54am, May 29, 2013</span>
            </p>
        </div>
	</div>
    <div class="email-content-body pure-u-1">
    <form class="pure-form">
	    <fieldset>

		    <div style="margin-top:10px;">
			    <span class="add-on">Rerun every</span>
			    <input class="span2" id="sleep-time" type="text" placeholder="0"/>
			    <span class="add-on">seconds</span>
			    <input class="span2" id="sleep-amt" type="text" placeholder="0"/>
			    <span class="add-on">times</span>
			</div>
		    <div style="margin-top:15px;"></div>

		    <label>Scrape URLS</label>
		    <textarea id="urls" class="input-xxlarge expanding" type="text" placeholder="http://dallas.craigslist.org/search/?areaID=21&subAreaID=&query=BOOTY&catAbb=sss"></textarea>
		    <div style="margin-top:50px;"></div>
			<button id="go" type="submit" class="pure-button pure-button-primary">Go</button>
	    </fieldset>
    </form>
    </div>
</div>
</div>
</div>

<!-- modals -->
<!--
<div id="chooseMessagesModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="chooseMessagesModalLabel" aria-hidden="true">
	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
		<h3 id="chooseMessagesModal">Choose Messages</h3>
	</div>
	<div class="modal-body">
		<table class="table table-condensed table-striped">
			<thead>
				<th></th><th>Subject</th><th>Body</th><th>From</th><th>Reports Enabled?</th>
			</thead>
			{% for message in messages %}
				<tr>
					<td><input class="message-selection" id="{{ message.id }}" type="checkbox"/></td>
					<td>{{ message.subject }}</td><td>{{ message.body }}</td><td>{{ message.fromAddress }}</td><td>{{ message.reportsEnabled }}</td>
				</tr>
			{% endfor %}
		</table>
	</div>
	<div class="modal-footer">
		<button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
	</div>
-->
{% endblock %}

<!-- js -->
{% block js %}
<script type="text/javascript">
$SCRIPT_ROOT = {{ request.script_root|tojson|safe }};

$('#go').click(function(event) {
	event.preventDefault();
	if ( $('#urls').val().split('\n')[0] != null ) {  // post ajax request to start sending messages
		var selectedMessages = '';
		$('.message-selection').each(function() {
			if ( $(this).is(':checked') )
				selectedMessages += $(this).prop('id') + ',';
		});

		$.getJSON($SCRIPT_ROOT + '/_go', {
			selectedMessages: selectedMessages,
			urls: $('#urls').val(),
			sleepTime: $('#sleep-time').val(),
		}, function(data) {
			//alert(data.result); // 1 or 0
		});
		
	};
	return false;
});
</script>
{% endblock %}
</body>
</html>